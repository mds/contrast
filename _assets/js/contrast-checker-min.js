const Color=require("color"),{createElement:h}=require("react"),{renderToStaticMarkup:renderToStaticMarkup}=require("react-dom/server"),homepage="https://github.com/jxnblk/contrast-swatch",parseURL=e=>{const{foreground:r,background:t,...o}=e.query;return r&&t?{foreground:r,background:t,query:o}:null},HEX=/^[A-Fa-f0-9]{3,6}$/,getColor=e=>{HEX.test(e)&&(e="#"+e);try{return Color(e)}catch(e){return null}},getLabel=e=>e>=7?"AAA":e>=4.5?"AA":e>=3?"lg":"Fail",parseColors=e=>{const r=getColor(e.foreground),t=getColor(e.background),o=r.contrast(t),n=getLabel(o);return{foreground:r,background:t,raw:e,hex:{foreground:r.hex(),background:t.hex()},rgb:{foreground:r.rgb().array(),background:t.rgb().array()},contrast:o,label:n}},round=e=>Math.floor(100*e)/100,svg=e=>{const r=parseURL(e);if(!r)return null;const t=parseColors(r),o=Object.assign({width:128,height:128,font:"system-ui,sans-serif",fontSize:1,fontWeight:700,baseline:0,label:!1,radius:0},r.query),n=Number(o.size||o.width),a=Number(o.size||o.height),s=n/a*32,u=8*Number(o.fontSize);let l=[round(t.contrast)];Boolean(o.label)&&l.push(t.label),o.text&&(l=[o.text]);const i=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:n,height:a,viewBox:`0 0 ${s} 32`,fill:t.hex.foreground,style:{fontFamily:o.font,fontWeight:o.fontWeight,fontSize:u}},h("rect",{width:s,height:32,fill:t.hex.background,rx:o.radius}),h("text",{textAnchor:"middle",x:s/2,y:16+Number(o.baseline),dominantBaseline:"middle"},l.join(" "))),g=renderToStaticMarkup(i);return{...r,colors:t,svg:g}};module.exports=async(e,r)=>{const t=svg(e);if(t){switch(t.query.type){case"json":return r.send(t)}r.setHeader("Content-Type","image/svg+xml;charset=utf-8"),r.send(t.svg)}};